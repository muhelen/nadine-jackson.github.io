<!DOCTYPE html>
<html>

<head>
  <title>Sentencle v5</title>
  <link rel="stylesheet" href="style.css">
</head>
<body onkeydown="enter(event)" onLoad="makeKeys()" onkeyup="releaseKey(event)" onresize="redraw()">

<div id="inputsquares">
</div>


<p>Guess the words (and punctuation) in the sentence.</p>



<div id="game">
</div>
<div id="info">
</div>
<div id="keyboard">

</div>



<script>
var Guess = "";
var Prev = "";
var Prevs = []
var Level = 0;
var Cursor = 20;
var Keysize = 20;
var Width = 0;
var Height = 0;

function takeGuess() {
  var x = document.getElementById("frm1");
  var text = "";
  var i;
  for (i = 0; i < x.length ;i++) {
    text += x.elements[i].value + "<br>";
  }
  return text;
}
function darkLetter(c){
  document.getElementById("key" + c).style["background-color"] = "DarkSlateGray"
}
function lightLetter(c){
  if (c == "3"){
  document.getElementById("key" + c).style["background-color"] = "Green";
}
else{
  document.getElementById("key" + c).style["background-color"] = "DimGray"
}
}
function update(guess, goal) {
  guess = guess.toUpperCase();
  streak = false;
  l = [];
  while ((guess.length > 0) && goal.includes(guess.charAt(0)))
  {
      while (goal.charAt(0) != guess.charAt(0)){
          streak = false;
          goal = goal.slice(1);
        }

      if (streak){
          last = l.pop();
          l.push(last + guess.charAt(0));
        }
      else{
          l.push(guess.slice(0, 1));
        }
      streak = true;
      guess = guess.slice(1);
      goal = goal.slice(1);
      //guess =;
    }
  return l;
  //return ["HELLO WORLD."]
}

  function updateGuess(key){
    Guess += "A";
  }

  function charXY(x, y, c){
    return "<div id=\"character\" style=\"position: absolute;\nleft: " + x.toString() + "px;\ntop: " + y.toString() + "px;\nwidth: " + Keysize.toString()+ "px;\nheight: " + Keysize.toString() + "px;\nfont-size: " + parseInt(Keysize * 0.8).toString() + "px;\">" + c + "</div>";
  }
  function spaceXY(x, y){
    return "<div id=\"spacer\" style=\"position: absolute;\nleft: " + x.toString() + "px;\ntop: " + y.toString() + "px;\nwidth: " + Keysize.toString() + "px;\nheight: " + Keysize.toString() + "px;\nfont-size: " + parseInt(Keysize * 0.8).toString() + "px;\">*</div>";
  }

function newXY(x, y, n, lbound = Keysize / 2, rbound = window.innerWidth - Keysize / 2){
  if (x < rbound - Keysize * 2){
    x += Keysize;
  }
  else{
    x = lbound;
    y += Keysize;
  }
  if (n == 0){
    return x;
  }
  return y;
}
function makeKey(c, x, y, w=Keysize, h=Keysize){
  keyID = "key" + c;
  md = " onclick=\"clickLetter('" + c + "')\"";
  if (c == " "){
    md = " onclick=\"clickSpace()\"";
  }
  mov = " onmouseover=\"darkLetter('" + c + "')\"" + " touchstart=\"lightLetter('" + c + "')\"";;
  mo = " onmouseout=\"lightLetter('" + c + "')\"" + " touchend=\"lightLetter('" + c + "')\"";

  if (c == "1"){
    c = "'";
  }
  else if (c == "2"){
    c = "<";
    md = " onclick=\"backPressed()\"";
  }
  if (c == "3"){
    c = "e";
    md = " onclick=\"enterPressed()\"";
    document.getElementById("keyboard").innerHTML += "<div id=\"" + keyID + "\" " + md + mo + mov + ">" + "Enter" +  "</div>";
    document.getElementById(keyID).style["background-color"] = "Green";
  }
  else{
    document.getElementById("keyboard").innerHTML += "<div id=\"" + keyID + "\" " + md + mo + mov + ">" + c +  "</div>";
    document.getElementById(keyID).style["background-color"] = "DimGray";
  }
  document.getElementById(keyID).style["color"] = "white";
  document.getElementById(keyID).style["text-align"] = "center";
  document.getElementById(keyID).style["font-family"] = "monospace,sans-serif";
  document.getElementById(keyID).style["width"] = w.toString() + "px";
  document.getElementById(keyID).style["height"] = h.toString() + "px";
  document.getElementById(keyID).style["border-radius"] = 3 + "px";
  document.getElementById(keyID).style["position"] = "absolute";
  document.getElementById(keyID).style["left"] = x.toString() + "px";
  document.getElementById(keyID).style["top"] = y.toString() + "px";
  document.getElementById(keyID).style["font-size"] = (parseInt(h * 0.8)).toString() + "px";
}
function makeKeys(){
  Width = window.innerWidth;
  Height = window.innerHeight;
  Level = Height / 4;
  if (Height / parseFloat(Width) > 1.7787){
    Height = parseInt(1.7787 * Width);
  }
  else {
    Width = parseInt(Height / 1.7787);
  }

  document.getElementById("game").style["height"] = (Height/2).toString() + "px";
  document.getElementById("game").style["width"] = (Width).toString() + "px";
  document.getElementById("game").style["top"] = (Height / 4).toString() + "px";
  document.getElementById("game").style["left"] = ((window.innerWidth / 2) - (Width / 2)).toString() + "px";
  board = ["QWERTYUIOP?", "ASDFGHJKL!,", "ZXCVBNM.1"];
  kbh = Height/4;
  document.getElementById("keyboard").style["height"] = (kbh).toString() + "px";
  document.getElementById("keyboard").style["width"] = (Width).toString() + "px";
  document.getElementById("keyboard").style["bottom"] = "0px";//(Height).toString() + "px";
  document.getElementById("keyboard").style["left"] = ((window.innerWidth / 2) - (Width / 2)).toString() + "px";
  Keysize = Width / 15;
  keyWidth = parseInt(Width / 11);
  keyHeight = parseInt(kbh / 5);
  keyWidth = parseInt(keyWidth * parseFloat(10.0 / 11));
  vspaceSize = keyHeight / 10;
  spaceSize = keyWidth / 10;
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2;
  y = (kbh - (4 * keyHeight + 3 * spaceSize)) / 2;
  //document.getElementById("keyboard").style["height"] = 300 + "px";
  for (var i = 0; i < board.length; i++){
    for (var j = 0; j < board[i].length; j++){
      c = board[i].slice(j, j+1);
      makeKey(c, x, y, keyWidth, keyHeight);
      x += keyWidth + spaceSize;
    }
    x = (Width - 11 * keyWidth - 10 * spaceSize) / 2;
    y += keyHeight + keyHeight / 10;
  }
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2;//space
  c = " ";
  makeKey(c, x, y, 8 * spaceSize + 9 * keyWidth, keyHeight);
  c = "2";//back
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2 + 9 * spaceSize + 9 * keyWidth;
  makeKey(c, x, y, 1 * spaceSize + 2 * keyWidth, keyHeight);
  //c = "1";//quote
  //x = parseInt(Keysize * 0.9) + 8 * spaceSize;
  //y = parseInt(Keysize * 0.9) + 2 * spaceSize;
  //makeKey(c, x, y, Keysize, Keysize);
  c = "3";//enter
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2 + 9 * keyWidth + 9 * spaceSize;
  y = (kbh - (4 * keyHeight + 3 * spaceSize)) / 2 + 2 * keyHeight + 2 * spaceSize;
  makeKey(c, x, y, keyWidth * 2 + spaceSize, keyHeight);
  }

function prettyPrint(l, g, y0, lbound = Keysize / 2, rbound = window.innerWidth / 2 - Keysize * 3 / 2){
  ret = "";
  x = lbound;
  y = y0;
  if (l.length == 0){
    ret += spaceXY(x, y);
    return ret;
  }
  beginning = l[0].slice(0, 1) == g.slice(0, 1);
  ending = l[l.length - 1].slice(-1) == g.slice(-1);
  if (! beginning){
    ret += spaceXY(x, y);
    y = newXY(x, y, 1, lbound, rbound);
    x = newXY(x, y, 0, lbound, rbound);
  }
  for (var i = 0; i < l.length; i++){
    for (var j = 0; j < (l[i]).length; j++){
      ret += charXY(x, y, l[i].slice(j, j+1));
      y = newXY(x, y, 1, lbound, rbound);
      x = newXY(x, y, 0, lbound, rbound);

    }
    if (i != l.length - 1){
      ret += spaceXY(x, y);
      y = newXY(x, y, 1, lbound, rbound);
      x = newXY(x, y, 0, lbound, rbound);
    }
  }
  if (! ending){
    ret += spaceXY(x, y);
    y = newXY(x, y, 1, lbound, rbound);
    x = newXY(x, y, 0, lbound, rbound);
  }
  return ret;
}
function testPrint(l){
  ret = "";
  for (i = 0; i < l.length; i++){
    for (j = 0; j < l[i].length; j++){
      ret += l[i][j] + "/";
    }
    ret += "<br/>";
  }
  return ret;
}
function printAll(l, goalSentence){
  y = Keysize;
  ret = "";
  for (i = l.length - 1; i >= 0; i--){
    ret += prettyPrint(l[i], goalSentence, y, Keysize / 2, Width - Keysize / 2);
    y += Keysize * 2;
  }
  return ret;
}
function incomplete(l, g){
    return ((! (l.length == 1)) || (! (l[0] === g)));}
function myFunction() {

  goalSentence = "You are the Universe itself.".toUpperCase();
  guess = Guess;
  current = update(guess, goalSentence);
  //text = "Guess: " + guess;
  text = prettyPrint(["GUESS: " + Guess], "GUESS: " + Guess, Keysize, Keysize / 2, Width - Keysize / 2);
  text += prettyPrint(current, goalSentence, parseInt(Height * 0.23)) + "<br/>";
  if (incomplete(current, goalSentence)){
    text += prettyPrint(["TRY AGAIN"], "TRY AGAIN", parseInt(Height * 0.43));
  }
  else{
    text += prettyPrint(["YOU WON!"], "YOU WON!", parseInt(Height * 0.43), Keysize / 2, Width - Keysize / 2);
  }
  //text += "<div id=\"game\">\n <div id=\"character\"></div>\n <div id=\"block\"></div>\n <div id=\"spacer\"></div>\n </div>"
  //text += "<div id=\"character\"></div>\n <div id=\"block\"></div>\n </div>\n </div>"
  if (Prevs.length > 0){
    document.getElementById("info").innerHTML = "<div id=\"infobox\" style=\"height: "+ Level.toString() + "px;\ntop: "+ parseInt(Height * 0.75) +"px;\nleft: "+ (window.innerWidth / 2 - Width / 2).toString() +"px;\nwidth: "+ parseInt(Width) +"px;\n\">" + printAll(Prevs, goalSentence) + "</div>";
  }

  //Prev += pretty_print(current, goalSentence, Level);
  if (current.length > 0){
    Prevs.push(current);
    Level += 6 * Keysize;
  }
  document.getElementById("game").innerHTML = text;
  //document.getElementById("info").innerHTML = "<div id=\"infobox\" style=\"height: " + (Level + 60).toString() + "px\">" + printAll(Prevs, goalSentence) + "</div>";

  Guess = "";
}
window.addEventListener('keydown', (e) => {
  if (e.keyCode === 32 && e.target === document.body) {
    e.preventDefault();
  }
});
function enterPressed(){
  myFunction();
  document.getElementById('inputsquares').innerHTML = "";
  Cursor = Keysize / 2;
}
function reset(s){
  Cursor = Keysize / 2;
  y = Keysize * 0.9;
  for (i = 0; i < s.length; i++){
    c = s[i];
    if (c == " ") {
      Cursor += Keysize;
    }
    else{
      //document.getElementById('userinput').value += x;
      document.getElementById('inputsquares').innerHTML += charXY(Cursor, y, c);

      y = newXY(Cursor, y, 1, Keysize / 2, window.innerWidth - Keysize / 2);
      Cursor = newXY(Cursor, y, 0, Keysize / 2, window.innerWidth - Keysize / 2);
    }
  }
}
function clickLetter(c){
  if (c == "1"){
    Guess += "'";
    document.getElementById('inputsquares').innerHTML = "";
    reset(Guess);

    Cursor += 20;
  }
  else{
  Guess += c.toUpperCase();
  //document.getElementById('userinput').value += x;
  document.getElementById('inputsquares').innerHTML = "";
  reset(Guess);
}
}
function backPressed(){
if(Guess.length > 0){
  document.getElementById('inputsquares').innerHTML = "";
  Guess = Guess.slice(0, Guess.length - 1);
  reset(Guess);
}}
function clickSpace(){
  if (Guess.length > 0 && Guess.slice(-1) != " "){
  Guess += " ";
  Cursor += 20;}
}
function enter(event) {
  var x = event.key;
  if (x != "1"){

  if (x == "'"){
    x = "1";
  }
  if (x == "Enter") {
    enterPressed();
  }
  else if (x == "Backspace"){
    backPressed();
  }
  else if (x == " ") {
    if (Guess.length > 0 && Guess.length < (13 * 5 - 7) && Guess.slice(-1) != " "){
    Guess += x;
    Cursor += 20;}
  }
  else if ("qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM.,?!1".includes(x) && Guess.length < (13 * 5 - 7)){
    darkLetter(x.toUpperCase());
    clickLetter(x);
  }}
}
function releaseKey(event) {
  var x = event.key;
  if (x == "'"){
    x = "1";
  }
  // If the pressed keyboard button is "a" or "A" (using caps lock or shift), alert some text.
  if ("qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM.,?!1 ".includes(x)){
    lightLetter(x.toUpperCase());
    //document.getElementById('userinput').value += x;
  }
}
function redraw(){
  document.getElementById("keyboard").innerHTML = "";
  makeKeys();
  document.getElementById("game").innerHTML = "";
  text = prettyPrint(["GUESS: " + Guess], "GUESS: " + Guess, Keysize, Keysize / 2, Width - (Keysize/2));
  text += prettyPrint(current, goalSentence, parseInt(Height * 0.23), Keysize / 2, Width - Keysize / 2);

  if (incomplete(current, goalSentence)){
    text += prettyPrint(["TRY AGAIN"], "TRY AGAIN", parseInt(Height * 0.43));
  }
  else{
    text += prettyPrint(["YOU WON!"], "Y!", parseInt(Height * 0.43));
  }
  document.getElementById("game").innerHTML = text;
  if (Prevs.length > 0){
    Level = parseInt(6 * Keysize * Prevs.length + Height * 0.25);
    document.getElementById("info").innerHTML = "<div id=\"infobox\" style=\"height: "+ Level.toString() + "px;\ntop: "+ parseInt(Height * 0.75) +"px;\nleft: "+ parseInt(window.innerWidth / 2 - Width / 2) +"px;\nwidth: "+ parseInt(Width) +"px;\n\">" + printAll(Prevs, goalSentence) + "</div>";
  }


  //document.getElementById("info").innerHTML = "<div id=\"infobox\" style=\"height: " + (Level + 60).toString() + "px\">" + printAll(Prevs, goalSentence) + "</div>";

  Guess = "";
}
</script>

</body>
</html>
