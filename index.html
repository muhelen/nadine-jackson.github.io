<!DOCTYPE html>
<html>

<head>
  <title>Sentencle v20</title>
  <link rel="stylesheet" href="style.css"></link>
</head>
<body id="body" onkeydown="enter(event)" onLoad="makeAll()" onkeyup="releaseKey(event)" onresize="redraw()">

<div id="banner"></div>

<div id="inputsquares">
</div>

<div id="game">
</div>
<div id="info">
</div>
<div id="keyboard">

</div>

<script src="./sentences.txt"></script>
<script>
var Guess = "";
var Prev = "";
var Prevs = []
var Level = 0;
var Cursor = 20;
var Keysize = 20;
var Width = 0;
var Height = 0;
var InputTop = 0;
var GameTop = 0;
var OutputTop = 0;
var Bound = 0;
var OldGuess = "";
var today = new Date();
var dd = String(today.getDate()).padStart(2, '0');
var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
var yyyy = today.getFullYear();
var key1 = new Audio('./KeyPress1.mp3');
var key2 = new Audio('./KeyPress2.mp3');
var doink = new Audio('./doink.mp3');
var SoundOn = true;
var recentLetter = '4';
function takeGuess() {
  var x = document.getElementById("frm1");
  var text = "";
  var i;
  for (i = 0; i < x.length ;i++) {
    text += x.elements[i].value + "<br>";
  }
  return text;
}
function darkLetter(c){
  document.getElementById("key" + c).style["background-color"] = "DarkSlateGray";
  document.getElementById("key" + c).style["color"] = "#E5F9E0";
}
function lightLetter(c){
  if (c == "3"){
  document.getElementById("key" + c).style["background-color"] = "#A3F7B5";
  document.getElementById("key" + c).style["color"] = "DarkSlateGray";
}
else{
  document.getElementById("key" + c).style["background-color"] = "#035E7B";
}
}
function update(guess, goal) {
  guess = guess.toUpperCase();
  streak = false;
  l = [];
  if (guess.slice(0, 1) != goal.slice(0, 1)){
    l.push("");
  }
  while ((guess.length > 0) && goal.includes(guess.charAt(0)))
  {
      while (goal.charAt(0) != guess.charAt(0)){
          streak = false;
          goal = goal.slice(1);
        }

      if (streak){
          last = l.pop();
          l.push(last + guess.charAt(0));
        }
      else{
          l.push(guess.slice(0, 1));
        }
      streak = true;
      guess = guess.slice(1);
      goal = goal.slice(1);
      //guess =;
    }
    if (guess.slice(-1) != goal.slice(-1)){
      l.push("");
    }
  return l;
  //return ["HELLO WORLD."]
}
function playSound(sound){
  if (SoundOn){
    sound2 = sound.cloneNode();
    sound2.play();
    //sound.play();
  }
}

  function updateGuess(key){
    Guess += "A";
  }

  function charXY(x, y, c){
    return "<div id=\"character\" style=\"position: absolute;\nleft: " + x.toString() + "px;\ntop: " + y.toString() + "px;\nwidth: " + Keysize.toString()+ "px;\nheight: " + Keysize.toString() + "px;\nfont-size: " + parseInt(Keysize * 0.8).toString() + "px;\">" + c + "</div>";
  }
  function spaceXY(x, y){
    return "<div id=\"spacer\" style=\"position: absolute;\nleft: " + x.toString() + "px;\ntop: " + y.toString() + "px;\nwidth: " + Keysize.toString() + "px;\nheight: " + Keysize.toString() + "px;\nfont-size: " + parseInt(Keysize * 0.8).toString() + "px;\">*</div>";
  }

function newXY(x, y, n, lbound = Bound, rbound = Width - Bound){
  if (x <= rbound - Keysize * 2){
    x += Keysize;
  }
  else{
    x = lbound;
    y += Keysize;
  }
  if (n == 0){
    return x;
  }
  return y;
}
function mute(){
  SoundOn = ! SoundOn;
  makeBanner();
}
function makeSound(){
  if (SoundOn){
    document.getElementById("banner").innerHTML = "<img id=\"sound\" src=\"./sound_on.png\" onclick=\"mute()\" alt=\"Sound on Symbol\"></img>";
  }
  else{
    document.getElementById("banner").innerHTML = "<img id=\"sound\" src=\"./sound_off.png\" onclick=\"mute()\" alt=\"Sound off Symbol\"></img>";
  }
  document.getElementById("sound").style["height"] = "50%";
  document.getElementById("sound").style["position"] = "absolute";
  document.getElementById("sound").style["top"] = "25%";
  document.getElementById("sound").style["right"] = InputTop / 4 + "px";
}
function makeBanner(){
  document.getElementById("banner").style["height"] = (InputTop).toString() + "px";
  document.getElementById("banner").style["width"] = (Width).toString() + "px";
  document.getElementById("banner").style["left"] = ((window.innerWidth / 2) - (Width / 2)).toString() + "px";
  makeSound();
  y0 = (InputTop - Keysize) / 2;
  lbound = (Width - Keysize * "SENTENCLE".length) / 2;
  document.getElementById("banner").innerHTML += prettyPrint("SENTENCLE", y0, lbound);
}
function makeInput(){
  document.getElementById("inputsquares").style["height"] = (Height / 4 - Height / 10 + 13).toString() + "px";
  document.getElementById("inputsquares").style["width"] = (Width).toString() + "px";
  document.getElementById("inputsquares").style["top"] = (InputTop).toString() + "px";
  document.getElementById("inputsquares").style["left"] = ((window.innerWidth / 2) - (Width / 2)).toString() + "px";
}
function makeGame(){
  document.getElementById("game").style["height"] = (Height/2).toString() + "px";
  document.getElementById("game").style["width"] = (Width).toString() + "px";
  document.getElementById("game").style["top"] = (GameTop).toString() + "px";
  document.getElementById("game").style["left"] = ((window.innerWidth / 2) - (Width / 2)).toString() + "px";
}
function makeKey(c, x, y, w=Keysize, h=Keysize){
  keyID = "key" + c;
  md = " onmousedown=\"mouseClickLetter('" + c + "')\"";
  if (c == " "){
    md = " onmousedown=\"clickSpace()\"";
  }
  mov = " onmouseover=\"darkLetter('" + c + "')\"";
  mo = " onmouseout=\"lightLetter('" + c + "')\"";
  //ts = " ontouchstart=\"mobileDarkLetter('" + c + "')\"";
  //te = " ontouchend=\"mobileClickLetter('" + c + "')\"";
  te = " ontouchend=\"lightLetter('" + c + "')\"";
  if (c == "1"){
    c = "'";
  }
  else if (c == "2"){
    c = "<";
    md = " onmousedown=\"backPressed()\"";
  }
  if (c == "3"){
    c = "e";
    md = " onmousedown=\"enterPressed()\"";
    document.getElementById("keyboard").innerHTML += "<div id=\"" + keyID + "\" " + md + mo + mov + ts + te + ">" + "Enter" +  "</div>";
    document.getElementById(keyID).style["background-color"] = "#A3F7B5";
    document.getElementById(keyID).style["font-size"] = (parseInt(h * 0.5)).toString() + "px";
    document.getElementById(keyID).style["color"] = "DarkSlateGray";
  }
  else{
    document.getElementById("keyboard").innerHTML += "<div id=\"" + keyID + "\" " + md + mo + mov + ts + te + ">" + c +  "</div>";
    document.getElementById(keyID).style["background-color"] = "#035E7B";
    document.getElementById(keyID).style["font-size"] = (parseInt(h * 0.8)).toString() + "px";
    document.getElementById(keyID).style["color"] = "#E5F9E0";
  }
  document.getElementById(keyID).addEventListener('touchend', event => {
    event.stopPropagation();
  });
  document.getElementById(keyID).style["text-align"] = "center";
  document.getElementById(keyID).style["font-family"] = "monospace,sans-serif";
  document.getElementById(keyID).style["width"] = w.toString() + "px";
  document.getElementById(keyID).style["height"] = h.toString() + "px";
  document.getElementById(keyID).style["border-radius"] = h/10 + "px";
  document.getElementById(keyID).style["position"] = "absolute";
  document.getElementById(keyID).style["left"] = x.toString() + "px";
  document.getElementById(keyID).style["top"] = y.toString() + "px";
  document.getElementById(keyID).style["touch-action"] = "manipulation";
}
function makeKeys(){


  //document.getElementById("banner").innerHTML = dd + "/" + mm + "/" + yyyy;
  board = ["QWERTYUIOP?", "ASDFGHJKL!,", "ZXCVBNM.1"];
  kbh = Height/4;
  document.getElementById("keyboard").style["height"] = (kbh).toString() + "px";
  document.getElementById("keyboard").style["width"] = (Width).toString() + "px";
  document.getElementById("keyboard").style["bottom"] = "0px";//(Height).toString() + "px";
  document.getElementById("keyboard").style["left"] = ((window.innerWidth / 2) - (Width / 2)).toString() + "px";

  Bound = (Width - 13 * Keysize - 1) / 2;
  keyWidth = parseInt(Width / 11);
  keyHeight = parseInt(kbh / 5);
  keyWidth = parseInt(keyWidth * parseFloat(10.0 / 11));
  vspaceSize = keyHeight / 10;
  spaceSize = keyWidth / 10;
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2;
  y = (kbh - (4 * keyHeight + 3 * spaceSize)) / 2;
  //document.getElementById("keyboard").style["height"] = 300 + "px";
  for (var i = 0; i < board.length; i++){
    for (var j = 0; j < board[i].length; j++){
      c = board[i].slice(j, j+1);
      makeKey(c, x, y, keyWidth, keyHeight);
      x += keyWidth + spaceSize;
    }
    x = (Width - 11 * keyWidth - 10 * spaceSize) / 2;
    y += keyHeight + keyHeight / 10;
  }
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2;//space
  c = " ";
  makeKey(c, x, y, 8 * spaceSize + 9 * keyWidth, keyHeight);
  c = "2";//back
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2 + 9 * spaceSize + 9 * keyWidth;
  makeKey(c, x, y, 1 * spaceSize + 2 * keyWidth, keyHeight);
  //c = "1";//quote
  //x = parseInt(Keysize * 0.9) + 8 * spaceSize;
  //y = parseInt(Keysize * 0.9) + 2 * spaceSize;
  //makeKey(c, x, y, Keysize, Keysize);
  c = "3";//enter
  x = (Width - 11 * keyWidth - 10 * spaceSize) / 2 + 9 * keyWidth + 9 * spaceSize;
  y = (kbh - (4 * keyHeight + 3 * spaceSize)) / 2 + 2 * keyHeight + 2 * spaceSize;
  makeKey(c, x, y, keyWidth * 2 + spaceSize, keyHeight);
  }
function makeAll(){
  Width = window.innerWidth;
  Height = window.innerHeight;
  Level = Height / 4;
  if (Height / parseFloat(Width) > 1.7787){
    Height = parseInt(1.7787 * Width);
  }
  else {
    Width = parseInt(Height / 1.7787);
  }
  InputTop = Height / 10;
  OutputTop = Height * 3 / 4;
  GameTop = Height / 4;
  Keysize = Width / 15;
  makeInput();
  makeGame();
  makeBanner();
  makeKeys();
}

function prettyPrintVintage(l, g, y0, lbound = Bound, rbound = Width - Bound){
  ret = "";
  x = lbound;
  y = y0;
  if (l.length == 0){
    ret += spaceXY(x, y);
    return ret;
  }

  beginning = l[0].slice(0, 1) == g.slice(0, 1);
  ending = l[l.length - 1].slice(-1) == g.slice(-1);
  if (! beginning){
    ret += spaceXY(x, y);
    y = newXY(x, y, 1, lbound, rbound);
    x = newXY(x, y, 0, lbound, rbound);
  }
  for (var i = 0; i < l.length; i++){
    for (var j = 0; j < (l[i]).length; j++){
      ret += charXY(x, y, l[i].slice(j, j+1));
      y = newXY(x, y, 1, lbound, rbound);
      x = newXY(x, y, 0, lbound, rbound);

    }
    if (i != l.length - 1){
      ret += spaceXY(x, y);
      y = newXY(x, y, 1, lbound, rbound);
      x = newXY(x, y, 0, lbound, rbound);
    }
  }
  if (! ending){
    ret += spaceXY(x, y);
    y = newXY(x, y, 1, lbound, rbound);
    x = newXY(x, y, 0, lbound, rbound);
  }
  return ret;
}
function prettyPrint(s, y0, lbound = Bound, rbound = Width - Bound){
  ret = "";
  x = lbound;
  y = y0;
  //s = l.join("*");
  for (var i = 0; i < s.length; i++){
    if (s.slice(i, i+1) == "*"){
      ret += spaceXY(x, y, s.slice(i, i+1));
    }
    else {
      ret += charXY(x, y, s.slice(i, i+1));
    }
      y = newXY(x, y, 1, lbound, rbound);
      x = newXY(x, y, 0, lbound, rbound);

  }
  return ret;
}
function testPrint(l){
  ret = "";
  for (i = 0; i < l.length; i++){
    for (j = 0; j < l[i].length; j++){
      ret += l[i][j] + "/";
    }
    ret += "<br/>";
  }
  return ret;
}
function printAll(l, goalSentence){
  y = Keysize;
  ret = "";
  for (i = l.length - 1; i >= 0; i--){
    s = l[i].join("*");
    ret += prettyPrint(s, y);
    y += Keysize * 2;
  }
  return ret;
}
function incomplete(l, g){
    return ((! (l.length == 1)) || (! (l[0] === g)));
  }
window.addEventListener('keydown', (e) => {
  if (e.keyCode === 32 && e.target === document.body) {
    e.preventDefault();
  }
});

function enterPressed(){
  if (Guess.length > 0){
  playSound(key2);
  goalSentence = SentenceBank[parseInt(dd) - 1].toUpperCase();
  OldGuess = Guess;
  current = update(OldGuess, goalSentence);
  text = prettyPrint("GUESS: " + OldGuess, Bound);
  text += prettyPrint(current.join("*"), parseInt(Height * 0.23));
  if (incomplete(current, goalSentence)){
    text += prettyPrint("TRY AGAIN", parseInt(Height * 0.43));
  }
  else{
    text += prettyPrint("YOU WON!", parseInt(Height * 0.43));
  }
  //text += "<div id=\"game\">\n <div id=\"character\"></div>\n <div id=\"block\"></div>\n <div id=\"spacer\"></div>\n </div>"
  //text += "<div id=\"character\"></div>\n <div id=\"block\"></div>\n </div>\n </div>"
  if (Prevs.length > 0){
    document.getElementById("info").innerHTML = "<div id=\"infobox\" style=\"height: "+ Level.toString() + "px;\ntop: "+ parseInt(Height * 0.75) +"px;\nleft: "+ (window.innerWidth / 2 - Width / 2).toString() +"px;\nwidth: "+ parseInt(Width) +"px;\n\">" + printAll(Prevs, goalSentence) + "</div>";
  }

  //Prev += pretty_print(current, goalSentence, Level);
  if (current.length > 0){
    Prevs.push(current);
    Level += 6 * Keysize;
  }
  document.getElementById("game").innerHTML = text;
  //document.getElementById("info").innerHTML = "<div id=\"infobox\" style=\"height: " + (Level + 60).toString() + "px\">" + printAll(Prevs, goalSentence) + "</div>";
  Guess = "";
  reset("");
}
else{
  playSound(doink);
}
}
function reset(s){
  Cursor = Bound;
  y = Bound;
  document.getElementById('inputsquares').style["height"] = (Height / 4 - Height / 10 + 13).toString() + "px";
  document.getElementById('inputsquares').innerHTML = "";
  GameTop = Height / 4;
  document.getElementById('game').style["top"] = (GameTop).toString() + "px";
  document.getElementById('game').style["height"] = (Height / 2).toString() + "px";
  for (i = 0; i < s.length; i++){
    c = s[i];
    if (c == " ") {
      y = newXY(Cursor, y, 1, Bound, Width - Bound);
      Cursor = newXY(Cursor, y, 0, Bound, Width - Bound);
    }
    else{
      //document.getElementById('userinput').value += x;
      document.getElementById('inputsquares').innerHTML += charXY(Cursor, y, c);

      y = newXY(Cursor, y, 1, Bound, Width - Bound);
      if (y > GameTop - InputTop - Bound - Keysize){
        document.getElementById('inputsquares').style["height"] = (GameTop - InputTop + Bound * 2 + Keysize).toString() + "px";
        GameTop += Keysize;
        document.getElementById('game').style["top"] = (GameTop).toString() + "px";
        document.getElementById('game').style["height"] = (OutputTop - GameTop).toString() + "px";
      }
      Cursor = newXY(Cursor, y, 0, Bound, Width - Bound);
    }
  }
}
function clickLetter(c){
  playSound(key1);
  if (c == "1"){
    Guess += "'";
    document.getElementById('inputsquares').innerHTML = "";
    reset(Guess);

    Cursor += 20;
  }
  else{
  Guess += c.toUpperCase();
  //document.getElementById('userinput').value += x;
  document.getElementById('inputsquares').innerHTML = "";
  reset(Guess);
}
}
function backPressed(){
if(Guess.length > 0){
  playSound(key2);
  document.getElementById('inputsquares').innerHTML = "";
  Guess = Guess.slice(0, Guess.length - 1);
  reset(Guess);
}
else{
  playSound(doink);
}
}
function clickSpace(){
  if (Guess.length > 0 && Guess.slice(-1) != " " && Guess.length < (13 * 5 - 7)){
    playSound(key2);
    Guess += " ";
    Cursor += 20;
  }
  else{
    playSound(doink);
  }
}
function enter(event) {
  var x = event.key;
  if (x != "1"){
  if (x == "'"){
    playSound(key1);
    x = "1";
  }
  if (x == "Enter") {
    enterPressed();
  }
  else if (x == "Backspace"){
    darkLetter("2");
    backPressed();
  }
  else if (x == " ") {
    darkLetter(" ");
    clickSpace();
  }
  else if ("qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM.,?!1".includes(x) && Guess.length < (13 * 5 - 7)){
    darkLetter(x.toUpperCase());
    clickLetter(x);
  }
  else if (Guess.length >= (13 * 5 - 7)){
    playSound(doink);
  }
}
}
function releaseKey(event) {
  var x = event.key;
  if (x == "'"){
    x = "1";
  }
  if (x == "Backspace"){
    x = "2";
  }
  // If the pressed keyboard button is "a" or "A" (using caps lock or shift), alert some text.
  if ("qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM.,?!12 ".includes(x)){
    lightLetter(x.toUpperCase());
    //document.getElementById('userinput').value += x;
  }
}
function mobileDarkLetter(c){
  darkLetter(c);
}
function mobileClickLetter(c){
  if (c == " "){
    clickSpace();
  }
  else if (c == "2"){
    backPressed();
  }
  else if (c == "3"){
    enterPressed();
  }
  else{
  clickLetter(c);
}
  recentLetter = c;
  lightLetter(c);
}
function mouseClickLetter(c){
  if (recentLetter != c){
  clickLetter(c);
  document.getElementById("banner").style["background-color"] = "Red";}
}
function redraw(){
  document.getElementById("keyboard").innerHTML = "";
  makeAll();
  reset(Guess);
  document.getElementById("game").innerHTML = "";
  text = prettyPrint("GUESS: " + OldGuess, Keysize);
  current = update(OldGuess, goalSentence);
  text += prettyPrint(current.join("*"), parseInt(Height * 0.23));
  if (incomplete(current, goalSentence)){
    text += prettyPrint("TRY AGAIN", parseInt(Height * 0.43));
  }
  else{
    text += prettyPrint("YOU WON!", parseInt(Height * 0.43));
  }
  document.getElementById("game").innerHTML = text;
  if (Prevs.length > 0){
    Level = parseInt(6 * Keysize * Prevs.length + Height * 0.25);
    document.getElementById("info").innerHTML = "<div id=\"infobox\" style=\"height: "+ Level.toString() + "px;\ntop: "+ parseInt(Height * 0.75) +"px;\nleft: "+ parseInt(window.innerWidth / 2 - Width / 2) +"px;\nwidth: "+ parseInt(Width) +"px;\n\">" + printAll(Prevs, goalSentence) + "</div>";
  }

}
</script>

</body>
</html>
